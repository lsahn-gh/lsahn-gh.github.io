<!DOCTYPE html>
<html lang="en-us">

  <head>
    
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-78144803-1', 'auto');
ga('send', 'pageview');
</script>


    <meta charset="utf-8">
    <meta name="generator" content="Hugo 0.37.1" />

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Yi-Soo An">
    <meta property="og:url" content="https://memnoth.github.io/2018/03/watch-out-your-input-file-stream/">

    <title>입력 스트림과 오류처리 - Memnoth</title>
    <meta property="og:title" content="입력 스트림과 오류처리 - Memnoth">
    <meta property="og:type" content="article">
    <meta name="description" content="">

    <link href="/index.xml" rel="alternate" type="application/rss+xml" title="Memnoth">

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inconsolata|Nanum+Myeongjo|Arvo:400,700">
<link rel="stylesheet" href="/css/highlight.css">
<link rel="stylesheet" href="/css/journal.css">

    <script defer src="https://use.fontawesome.com/releases/v5.0.8/js/all.js" integrity="sha384-SlE991lGASHoBfWbelyBPLsUlwY1GwNDJo3jSJO04KZ33K2bwfV9YBauFfnzvynJ" crossorigin="anonymous"></script>
  </head>

  <body>
    <div class="container">

      <nav class="site-nav">
        <a href="https://memnoth.github.io/">Index</a>
      </nav>


  <article class="post">
    <header class="post-header">
      <h1 class="post-title">입력 스트림과 오류처리</h1>
      <time class="post-date" datetime="2018-03-07 00:00:00 UTC">07 Mar 2018</time>
    </header>

    <p>우리가 프로그래밍을 하며 자주 사용하는 것이 입출력 스트림입니다. 대부분의 프로그램들이 처리하는 일련의 과정들은 주변장치로 부터 데이터들을 입력 받고, 처리하고, 다시 출력하는 것입니다. 하지만 모든 입력에 대해 올바르다고 가정하여 무결성 검사에 신경쓰지 않는다면 제대로된 프로그램이라 할 수 없으며 입력에 대한 오류처리가 출력보다 까다롭기 때문에 그것에 관해 이야기를 해보려고 합니다.</p>

<p>오늘 살펴볼 코드는 책<sup class="footnote-ref" id="fnref:1"><a href="#fn:1">1</a></sup>의 챕터 10, 연습문제 1를 기반으로 구현되었으며 해당 문제의 정의는 다음과 같습니다; <strong>파일에 공백으로 구분된 정수들이 담겨 있다. 그 수치들 모두의 합을 계산하는 프로그램을 작성하라</strong> (<a href="https://gist.github.com/memnoth/20a8d50f3d901af57c985e1fed583e79">풀 코드는 이곳으로</a>). 문제는 공백으로 구분되는 수치이지만 우리는 오류처리를 테스트하기 위해 <strong>수치는 모두 입력받도록</strong> 다시 정의합니다.<br />
다음은 파일로 부터 값을 입력받는 함수입니다.
<script src="https://gist.github.com/memnoth/135c1aec02ab3ad817add34caa7d4b2c.js"></script></p>

<p>우선 8번째 라인부터 살펴보겠습니다. cppreference<sup class="footnote-ref" id="fnref:2"><a href="#fn:2">2</a></sup>에 따르면 <code>ios_base::badbit</code>은 irrecoverable stream error로 정의를 하고 있습니다. 이는 디스크 읽기 실패 등과 같은 사용자가 복구할 수 없는 치명적인 오류를 의미합니다. 해당 코드대신 다음과 같이 쓸 수 있겠으나 런타임(run-time)에서 사용자가 조치할 수 있는 방법이 없으므로 예외로 넘깁니다.</p>

<pre><code class="language-cpp">if (ist.bad()) {
    // do something, like kill process.
}
</code></pre>

<hr />

<pre><code class="language-cpp">int number;
ist &gt;&gt; number;
</code></pre>

<p>위 코드에서 값을 받아올 때 형식(type)을 확인하여 int가 아니라면 스트림의 상태(state)가 <code>failbit</code>으로 설정됩니다. 따라서 형식의 타당성을 검증하여 <strong>[18]</strong> 또는 <strong>[20:24]</strong> 의 코드를 실행합니다.</p>

<hr />

<pre><code class="language-cpp">ist.clear();
</code></pre>

<p>입력 스트림(ist)의 상태를 <code>good</code>으로 변경합니다. <code>failbit</code>이 설정된 것은 입력 형식 오류이며 프로그램에서 복구할 수 있기 때문에 아래 로직을 실행합니다.</p>

<pre><code class="language-cpp">char ch;
while (ist &gt;&gt; ch &amp;&amp; !isdigit(ch));
ist.unget();
</code></pre>

<p>입력 <strong>문자</strong>가 숫자가 아닌 모든 값은 쓰레기이므로 버립니다. 숫자가 입력되면 loop를 빠져나오고 방금 읽어 온 값을 다시 입력 스트림에 넣습니다. 사실 입력 스트림은 방금까지 가지고 있던 문자를 기억하고 있으므로 put_back대신 unget을 이용합니다.</p>

<hr />

<p>이제 테스트를 위해 다음 내용을 메모장에 저장하여 실행합니다.  예상대로라면 <strong>67</strong>이 출력되어야 합니다.</p>

<pre><code class="language-shell">$ cat ./number.txt
1 x 2 x x x f 3 4 f 
f1 
f1 
f10f
fff 5*$#($*#(&amp;%#()))6 
7 8 9 10

$ ./exer01
파일 이름을 입력하세요.
number.txt
합: 67
$
</code></pre>

<p>오류처리가 제대로 동작됨을 확인할 수 있습니다.</p>
<div class="footnotes">

<hr />

<ol>
<li id="fn:1"><em>&ldquo;Programming Principle and Practice Using C++&rdquo;</em> &ndash; Bjarne Stroustrup
 <a class="footnote-return" href="#fnref:1"><sup>[return]</sup></a></li>
<li id="fn:2"><a href="http://en.cppreference.com/w/cpp/io/ios_base/iostate">http://en.cppreference.com/w/cpp/io/ios_base/iostate</a>
 <a class="footnote-return" href="#fnref:2"><sup>[return]</sup></a></li>
</ol>
</div>


  </article>


      <footer class="site-footer">
        <span itemscope itemtype="http://schema.org/Person">
          <link itemprop="url" href="https://memnoth.github.io/">
          <span itemprop="name">Yi-Soo An</span>

          ,
          <span itemprop="jobTitle"></span> at
          <span itemprop="memberOf" itemscope itemtype="http://schema.org/Organization"><a itemprop="url" href=""><span itemprop="name"></span></a></span><br>

          <a itemprop="sameAs" href="https://memnoth.github.io/index.xml" title="RSS"><i class="fas fa-rss-square fa-2x"></i></a>

          <a itemprop="sameAs" href="//github.com/memnoth" title="GitHub"><i class="fab fa-github fa-2x"></i></a>

          <a itemprop="sameAs" href="//gitlab.gnome.org/memnoth" title="Gnome"><i class="fab fa-gitlab fa-2x"></i></a>
          
          <a itemprop="sameAs" href="//twitter.com/iamt0mmy" title="Twitter"><i class="fab fa-twitter fa-2x"></i></a>

          <a itemprop="sameAs" href="//plus.google.com/" title="Google+"><i class="fab fa-google-plus fa-2x"></i></a>

        </span>

        
      </footer>
    </div>

  <script src="/js/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  </body>
</html>

