<!DOCTYPE html>
<html lang="en-us">

  <head>
    
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-78144803-1', 'auto');
ga('send', 'pageview');
</script>


    <meta charset="utf-8">
    <meta name="generator" content="Hugo 0.37.1" />

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Yi-Soo An">
    <meta property="og:url" content="https://memnoth.github.io/2015/02/performance-overhead-of-sqlalchemy/">

    <title>Performance overhead of sqlalchemy - Memnoth</title>
    <meta property="og:title" content="Performance overhead of sqlalchemy - Memnoth">
    <meta property="og:type" content="article">
    <meta name="description" content="">

    <link href="/index.xml" rel="alternate" type="application/rss+xml" title="Memnoth">

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inconsolata|Nanum+Myeongjo|Arvo:400,700">
<link rel="stylesheet" href="/css/highlight.css">
<link rel="stylesheet" href="/css/journal.css">

    <script defer src="https://use.fontawesome.com/releases/v5.0.8/js/all.js" integrity="sha384-SlE991lGASHoBfWbelyBPLsUlwY1GwNDJo3jSJO04KZ33K2bwfV9YBauFfnzvynJ" crossorigin="anonymous"></script>
  </head>

  <body>
    <div class="container">

      <nav class="site-nav">
        <a href="https://memnoth.github.io/">Index</a>
      </nav>


  <article class="post">
    <header class="post-header">
      <h1 class="post-title">Performance overhead of sqlalchemy</h1>
      <time class="post-date" datetime="2015-02-27 00:00:00 UTC">27 Feb 2015</time>
    </header>

    <p>원문 &ndash; <a href="http://www.pythoncentral.io/sqlalchemy-faqs/">Performance Overhead of SQLAlchemy</a> by Xiaonuo Gantan<br />
번역 &ndash; Yi Soo, (Thomas) An</p>

<hr />

<pre><code class="language-python">import time
import sqlite3
 
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy import Column, Integer, String, create_engine
from sqlalchemy.orm import scoped_session, sessionmaker
 
Base = declarative_base()
session = scoped_session(sessionmaker())
 
class User(Base):
    __tablename__ = &quot;user&quot;
    id = Column(Integer, primary_key=True)
    name = Column(String(255))
 
def init_db(dbname='sqlite:///example.db'):
    engine = create_engine(dbname, echo=False)
    session.remove()
    session.configure(bind=engine, autoflush=False, expire_on_commit=False)
    Base.metadata.drop_all(engine)
    Base.metadata.create_all(engine)
    return engine
 
def test_sqlalchemy_orm(number_of_records=100000):
    init_db()
    start = time.time()
    for i in range(number_of_records):
        user = User()
        user.name = 'NAME ' + str(i)
        session.add(user)
    session.commit()
    end = time.time()
    print &quot;SQLAlchemy ORM: Insert {0} records in {1} seconds&quot;.format(
        str(number_of_records), str(end - start)
    )
 
def test_sqlalchemy_core(number_of_records=100000):
    engine = init_db()
    start = time.time()
    engine.execute(
        User.__table__.insert(),
        [{&quot;name&quot;: &quot;NAME &quot; + str(i)} for i in range(number_of_records)]
    )
    end = time.time()
    print &quot;SQLAlchemy Core: Insert {0} records in {1} seconds&quot;.format(
        str(number_of_records), str(end - start)
    )
 
def init_sqlite3(dbname=&quot;sqlite3.db&quot;):
    conn = sqlite3.connect(dbname)
    cursor = conn.cursor()
    cursor.execute(&quot;DROP TABLE IF EXISTS user&quot;)
    cursor.execute(&quot;CREATE TABLE user (id INTEGER NOT NULL, name VARCHAR(255), PRIMARY KEY(id))&quot;)
    conn.commit()
    return conn
 
def test_sqlite3(number_of_records=100000):
    conn = init_sqlite3()
    cursor = conn.cursor()
    start = time.time()
    for i in range(number_of_records):
        cursor.execute(&quot;INSERT INTO user (name) VALUES (?)&quot;, (&quot;NAME &quot; + str(i),))
    conn.commit()
    end = time.time()
    print &quot;sqlite3: Insert {0} records in {1} seconds&quot;.format(
        str(number_of_records), str(end - start)
    )
 
if __name__ == ”__main__”:
    test_sqlite3()
    test_sqlalchemy_core()
    test_sqlalchemy_orm()
</code></pre>

<ol>
<li>Raw SQL</li>
<li>Core of SQLAlchemy</li>
<li>ORM of SQLAlchemy</li>
</ol>

<p>10만개의 dummy 자료를 삽입하여 위 3가지 방식의 성능을 비교하려고 합니다.<br />
여러분이 테스트해도 비슷한 결과가 나올 것입니다.</p>

<pre><code>$ python orm_performance_overhead.py
sqlite3: Insert 100000 records in 0.226176977158 seconds
SQLAlchemy core: Insert 100000 records in 0.371157169342 seconds
SQLAlchemy ORM: Insert 100000 records in 10.1760079861 seconds
</code></pre>

<p>주목할 점은 1번과 2번은 고민해 볼만한 성능을 내지만 그에 비해 ORM은 너무 느린 것입니다.<br />
ORM이 성능 저하를 가져오긴 하지만 이 성능 저하는 오직 많은 양의 데이터를 삽입하고자 할 때만 중요해 진다는 것을 명심해야합니다.</p>

<p>웹이 하나의 요청에 하나의 응답으로 처리되는 CRUD의 구조상, 편리함과 유지보수를 위해 1번, 2번 대신 3번을 고려해 볼 수 있습니다.</p>


  </article>


      <footer class="site-footer">
        <span itemscope itemtype="http://schema.org/Person">
          <link itemprop="url" href="https://memnoth.github.io/">
          <span itemprop="name">Yi-Soo An</span>

          ,
          <span itemprop="jobTitle"></span> at
          <span itemprop="memberOf" itemscope itemtype="http://schema.org/Organization"><a itemprop="url" href=""><span itemprop="name"></span></a></span><br>

          <a itemprop="sameAs" href="https://memnoth.github.io/index.xml" title="RSS"><i class="fas fa-rss-square fa-2x"></i></a>

          <a itemprop="sameAs" href="//github.com/memnoth" title="GitHub"><i class="fab fa-github fa-2x"></i></a>

          <a itemprop="sameAs" href="//gitlab.gnome.org/memnoth" title="Gnome"><i class="fab fa-gitlab fa-2x"></i></a>
          
          <a itemprop="sameAs" href="//twitter.com/iamt0mmy" title="Twitter"><i class="fab fa-twitter fa-2x"></i></a>

          <a itemprop="sameAs" href="//plus.google.com/" title="Google+"><i class="fab fa-google-plus fa-2x"></i></a>

        </span>

        
      </footer>
    </div>

  <script src="/js/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  </body>
</html>

