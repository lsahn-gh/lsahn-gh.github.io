[{"body":"","link":"https://www.ooseel.net/me/","section":"","tags":null,"title":""},{"body":"","link":"https://www.ooseel.net/me/posts/","section":"posts","tags":null,"title":""},{"body":"","link":"https://www.ooseel.net/me/tags/arm64/","section":"tags","tags":null,"title":"arm64"},{"body":"esBPF project has been over one year and it began with the idea that Is it worth filtering ingress packets on Software-Offload layer instead of Network Stack? Software-Offload is similar to Hardware-Offload, but it works in ethernet driver. Now time to do Stress-testing since its prototype was released and the comparison object will be iptables.\nBefore walking through the article, let me define a few short terms against typing exhausting long terms,\n   Long Term Short Term     Raspberry Pi 3 Rpi3   Host Machine Host    Testbed Host and Rpi3 are on link connection of the same LAN of the AP below that it supports HW-offload and being Bridge mode against its Kernel interrupts forwarding packets between them.\n1 High-Performance AP 2 - HW-offload Supported 3 - Bridge Mode 4 +-----------------+ 5 | Wireless AP | 6 +-----------------+ 7 100Mbps link | | 1Gbps link 8 +----------+ +-----------+ 9 | | 10+-------------------+ +-------------------+ 11| Raspberry Pi 3 | | Host Machine | 12| (192.168.219.103) | | (192.168.219.108) | 13+-------------------+ +-------------------+ Also using hping3 program for Stress-testing that is going to be just flooding ICMP packets to Rpi3.\n1$ hping3 --icmp --faster 192.168.219.103 -d 20 Tuning Raspberry-Pi 3 for the testing  Ubuntu 22.10 Kinetic Release - Kernel 5.19.0-1007 (Arm64) Enable CONFIG_HOTPLUG_CPU to on/off CPU cores esBPF-based customized eth driver, smsc95xx-esbpf Off wlan0 interface not to mess up routing  It's set up using 2 cores instead of entire CPUs to load up full traffic on a specific number of cores by maxcpus=2 at boot command-line. Hence we have 2 online and offline cores respectively,\n1ubuntu@ubuntu:~$ lscpu 2Architecture: aarch64 3 CPU op-mode(s): 32-bit, 64-bit 4 Byte Order: Little Endian 5CPU(s): 4 6 On-line CPU(s) list: 0,1 7 Off-line CPU(s) list: 2,3 8Vendor ID: ARM 9 Model name: Cortex-A53 Briefing about smsc95xx-esbpf Two significant files exist under a directory /proc/smsc95xx/esbpf once the driver has been loaded on Kernel and each other is responsible for ...\n rx_enable : turns on/off esbpf operations. rx_hooks : is supposed to be written by a program of cBPF instructions.  Stress-testing We are going to look at mpstat values and compare NET_RX in /proc/softirqs before and after executing hping3. Please suppose the program would be running for 60 seconds on Host in each case.\nHere is the idle usage of the CPUs of Rpi3. The idle columns are almost the same in both testing cases, iptables and Software-Offload before generating massive traffic on the LAN.\n1$ mpstat -P ALL 3 2CPU %usr %nice %sys %iowait %irq %soft %steal %guest %gnice %idle 3all 0.00 0.00 0.17 0.00 0.00 0.17 0.00 0.00 0.00 99.66 4 0 0.00 0.00 0.34 0.00 0.00 0.00 0.00 0.00 0.00 99.66 5 1 0.00 0.00 0.00 0.00 0.00 0.34 0.00 0.00 0.00 99.66 1. iptables In the first test, the following rule is supposed to be appended in INPUT part on Rpi3 and as the result, one of the CPUs is being performed by softirq which means so busy to work.\n1$ iptables -A INPUT -p icmp -j DROP 2$ iptables -nvL 3Chain INPUT (policy ACCEPT 0 packets, 0 bytes) 4 pkts bytes target prot opt in out source destination 5 0 0 DROP icmp -- * * 0.0.0.0/0 0.0.0.0/0 6 7# NET_RX softirq count before massive traffic 8 CPU0 CPU1 CPU2 CPU3 9 NET_RX: 123 66 0 0 10 11# NET_RX softirq count after that 12 CPU0 CPU1 CPU2 CPU3 13 NET_RX: 15040 35021 0 0 14 15# mpstat 16CPU %usr %nice %sys %iowait %irq %soft %steal %guest %gnice %idle 17all 0.00 0.00 0.18 0.00 0.00 52.89 0.00 0.00 0.00 46.94 18 0 0.00 0.00 0.37 0.00 0.00 0.74 0.00 0.00 0.00 98.89 19 1 0.00 0.00 0.00 0.00 0.00 100.00 0.00 0.00 0.00 0.00 2. esBPF In the second test, it's going to drop the same type of packets in Software-Offload, in other words, in-driver. Special tools are required for doing that, tcpdump and filter_icmp but the latter already has hard-coded cBPF instructions, so tcpdump ain't necessary at this point.\nThe hard-coded part is as follows\n1struct sock_filter insns[] = { 2 /* tcpdump -dd -nn icmp */ 3 { 0x28, 0, 0, 0x0000000c }, 4 { 0x15, 0, 3, 0x00000800 }, 5 { 0x30, 0, 0, 0x00000017 }, 6 { 0x15, 0, 1, 0x00000001 }, 7 { 0x6, 0, 0, 0x00040000 }, 8 { 0x6, 0, 0, 0x00000000 }, 9}; and the program is executed by the following command that actually tries writing the above instructions to esBPF module.\n1$ sudo ./filter_icmp /proc/smsc95xx/esbpf/rx_hooks 2$ sudo echo 1 \u0026gt; /proc/smsc95xx/esbpf/rx_enable Even though hping3 works in the same flow, NET_RX didn't rise as much as the first case.\n1# NET_RX softirq count before massive traffic 2 CPU0 CPU1 CPU2 CPU3 3 NET_RX: 129 81 0 0 4 5# NET_RX softirq count after that 6 CPU0 CPU1 CPU2 CPU3 7 NET_RX: 141 94 0 0 Also, the average usage of CPUs by softirq is around 8% up to 30% by looking at the best and worst cases respectively.\n1# mpstat in the best case 2CPU %usr %nice %sys %iowait %irq %soft %steal %guest %gnice %idle 3all 0.00 0.00 0.64 0.00 0.00 7.99 0.00 0.00 0.00 91.37 4 0 0.00 0.00 0.65 0.00 0.00 6.54 0.00 0.00 0.00 92.81 5 1 0.00 0.00 0.62 0.00 0.00 9.38 0.00 0.00 0.00 90.00 6 7# mpstat in the worst case 8CPU %usr %nice %sys %iowait %irq %soft %steal %guest %gnice %idle 9all 18.31 0.00 4.58 0.96 0.00 27.47 0.00 0.00 0.00 48.67 10 0 14.50 0.00 4.00 1.00 0.00 26.00 0.00 0.00 0.00 54.50 11 1 21.86 0.00 5.12 0.93 0.00 28.84 0.00 0.00 0.00 43.26 Notice that you may sometimes see a few ICMP packets come to Network Stack although esBPF is enabled. No worries they are just from lo interface.\nConclusion esBPF works on Software-Offload, as known as device driver layer against Netfilter, a superset of iptables which works in Network Stack. Hence it drops all incoming packets matched to the filters in Tasklet level instead of NET_RX (part of Network Stack) and as we see the result of esBPF, Kernel doesn't need any extra tasks.\nThe project could be better than packet filtering in Network Stack in some cases even though the worst case takes CPU resources about four times than the best case. Of course, It depends on how big/long cBPF instructions are in esBPF though.\nThe project is still in progress such as being more flexible, optimizing, and taking Cache mechanism.\nI figured out through this Stress-testing that it will be worth putting more effort into the project and keep working, at least I don't waste my time. Also, it was a nice time to take the responsibility for the entire process from design to testing.\nI hope everyone has enjoyed the article, cheers ;-)\n","link":"https://www.ooseel.net/me/2022/11/esbpf-stress-testing-compares-software-offload-with-iptables/","section":"posts","tags":["Ubuntu","Arm64","Linux","Kernel"],"title":"esBPF: Stress-Testing compares Software-Offload with iptables"},{"body":"","link":"https://www.ooseel.net/me/tags/kernel/","section":"tags","tags":null,"title":"kernel"},{"body":"","link":"https://www.ooseel.net/me/tags/linux/","section":"tags","tags":null,"title":"Linux"},{"body":"","link":"https://www.ooseel.net/me/tags/","section":"tags","tags":null,"title":"Tags"},{"body":"","link":"https://www.ooseel.net/me/tags/ubuntu/","section":"tags","tags":null,"title":"ubuntu"},{"body":"Whole processes, git cloning the right codebase from a repository, installing all the packages, kernel configuration, and finally go building are such a challenge for beginners like me. Fortunately, Ubuntu Kernel Team provides an easy system for building kernel though.\nIn this article, we are going to look at some requirements. In more detail, try installing build tools, get ready, and building :-)\nGet ready for upstream kernel and environment Canonical, a company mainly supports Ubuntu distro maintains its Kernel sources at Launchpad, but for Raspberry Pi, it's maintained at this repository.\nI'm currently running Kinetic release on my raspberry pi but wanna switch to an upstream kernel of master-next branch. Launchpad page has an instruction such as what to do in each branch of each repository in more detail but all I need now is the following address to clone,\n1$ mkdir linux; cd linux 2$ git clone -b master-next \\ 3 https://git.launchpad.net/~ubuntu-kernel/ubuntu/+source/linux-raspi/+git/kinetic \\ 4 ./ubuntu-upstream-kernel 5$ cd ubuntu-upstream-kernel also, we have to install the following packages but keep in mind that some of them aren't supported in older releases or needs. This article is based on 22.04.1 LTS.\n1$ sudo apt build-dep linux linux-image-$(uname -r) 2$ sudo apt install libncurses-dev gawk flex bison openssl libssl-dev dkms \\ 3 libelf-dev libudev-dev libpci-dev libiberty-dev autoconf llvm curl \\ 4 gcc-12-aarch64-linux-gnu gcc-12-aarch64-linux-gnu-base gcc-12 g++-12 \\ 5 linux-tools-common fakeroot debhelper gcc-aarch64-linux-gnu Let's go! Most of the branches for Ubuntu kernel have extra directories, debian, debian.master, and debian.raspi which have special files such as basic scripts, configs, and target info respectively. In my case, raspberry pi configs are in the latter one.\nAll we need to do is run scripts in debian but others are nothing care.\n1# Now we are in \u0026#39;ubuntu-upstream-kernel\u0026#39; 2 3$ export $(dpkg-architecture -aarm64) 4$ export CROSS_COMPILE=aarch64-linux-gnu- 5 6$ LANG=C fakeroot debian/rules clean # cleaning any garbages 7$ LANG=C fakeroot debian/rules editconfigs # menuconfig if you need 8$ LANG=C fakeroot debian/rules binary-headers binary binary-perarch It will take a long and long time even though you are done with having meals, and going for a walk... so forget it at least for 2 hours.\nThen you have some deb packages in the parents' directory like these,\n1linux-buildinfo-5.19.0-1006-raspi_5.19.0-1006.13_arm64.deb 2linux-modules-extra-5.19.0-1006-raspi_5.19.0-1006.13_arm64.deb 3linux-headers-5.19.0-1006-raspi_5.19.0-1006.13_arm64.deb 4linux-raspi-headers-5.19.0-1006_5.19.0-1006.13_arm64.deb 5linux-image-5.19.0-1006-raspi_5.19.0-1006.13_arm64.deb 6linux-modules-5.19.0-1006-raspi_5.19.0-1006.13_arm64.deb It's all up to you what to do with them, cheers :-)\n","link":"https://www.ooseel.net/me/2022/11/build-upstream-ubuntu-kernel-for-arm64-raspberry-pi/","section":"posts","tags":["ubuntu","arm64","kernel"],"title":"Build upstream Ubuntu Kernel for Arm64 Raspberry-Pi"},{"body":"í•´ì™¸ ì—¬í–‰ ì¤€ë¹„ë¡œ English Speakingê³¼ ê´€ë ¨ëœ ì—¬ëŸ¬ê°€ì§€ ë°©ë²•ì„ ì°¾ì•„ë³´ê³  ìˆë‹¤. í•œë‹¬ ë’¤ì— ì¶œêµ­ ì˜ˆì •ì´ë¯€ë¡œ ê¸°ë³¸ ëŒ€í™”ê°€ ê°€ëŠ¥í•˜ê³  í‹€ë ¤ë„ ìì‹ ê°ìˆê²Œ ë§í•˜ê¸° ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì€ ë°©ë²•ì„ ìƒê°í•´ë´¤ëŠ”ë°...\n ì˜¤í”„ë¼ì¸ ì–¸ì–´ êµí™˜ì— ë‚˜ê°„ë‹¤. ì „í™” ì˜ì–´ë¥¼ í•´ë³¸ë‹¤. ë¯¸ë“œ ì‰ë„ì‰ ì˜¨ë¼ì¸ ì–¸ì–´ êµí™˜ ì•± ì‚¬ìš©í•˜ê¸°.  1. ì˜¤í”„ë¼ì¸ ì–¸ì–´ êµí™˜ ì°¸ì„ ë‚˜ì™€ ë§ì§€ ì•ŠëŠ”ë‹¤. ì˜ˆì „ì— ìì‹ ê°ì—†ê³  speakingì´ ìµìˆ™í•˜ì§€ ì•Šì€ ìƒíƒœì—ì„œ ë‚˜ê°€ë‹ˆê¹Œ 2ì‹œê°„ ë‚´ë‚´ ì•„ë¬´ë§ë„ ì•ˆí•˜ê³  free talkingì¸ë° í•  ì–˜ê¸°ê°€ ì—†ì–´ì„œ Ok, Yes, No ë§Œ í•˜ë‹¤ê°€ ì™”ë‹¤. ê·¸ë˜ì„œ íŒ¨ìŠ¤.\n2. ì „í™” ì˜ì–´ 1:1ì´ê³  íŠœí„°ê°€ êµì •ì„ í•´ì£¼ëŠ” ì¥ì ì´ ìˆëŠ”ë° ë‚´ê°€ ì´ˆë³´ì ìˆ˜ì¤€ì´ë¼ì„œ ì˜¤ëŠ˜ í•˜ë£¨ ì–´ë• ë‹ˆ, ë­í–ˆë‹ˆ, ê°ì • í‘œí˜„ ê°™ì€ ê²ƒë“¤ì´ ëŒ€ë¶€ë¶„ì´ê³  ìœ ë£Œì´ë‹¤. íš¨ìœ¨ì´ ì•ˆ ë‚˜ì™€ì„œ íŒ¨ìŠ¤.\n3. ë¯¸ë“œ ì‰ë„ì‰ ë‹¨ê¸°ê°„ì— ëª©í‘œ(ê¸°ë³¸ì ì¸ ëŒ€í™” ë° ìì‹ ê° ìƒìŠ¹) ë‹¬ì„±ì´ í˜ë“¤ê²ƒ ê°™ì•„ íŒ¨ìŠ¤. ë‚´ê°€ ì¢‹ì•„í•˜ëŠ” ë¯¸ë“œë„ ì—†ë‹¤.\n3. ì˜¨ë¼ì¸ ì–¸ì–´ êµí™˜ ì•± ì‚¬ìš© - hilokal 3ì¼ì „ì— hilokal ì´ë€ ì–¸ì–´ êµí™˜ ì•±ì„ ì•Œê²Œë˜ì—ˆë‹¤. í´ëŸ½í•˜ìš°ìŠ¤ì²˜ëŸ¼ ì°¸ì—¬í•´ì„œ ì§ì ‘ target languageë¡œ speakingí•˜ê³  language improvementê°€ ëª©ì ì´ë‹¤. ì—¬ê¸°ì— í¬ê²Œ 2ê°€ì§€ ì„±ê²©ì„ ê°€ì§„ í…Œì´ë¸”(ì—¬ê¸°ì„  ë°©ì„ í…Œì´ë¸”ì´ë¼ ì¹­í•˜ë”ë¼)ì´ ì¡´ì¬í•œë‹¤. ì²«ë²ˆì§¸ëŠ” ê·¸ëƒ¥ ëª¨ì—¬ì„œ ëœë¤ ì±„íŒ…ì‹ìœ¼ë¡œ ì–˜ê¸°í•˜ëŠ”ë° ë§ ì—„ì²­ë¹ ë¥´ê³  slangì´ ë„ˆë¬´ ë§ë‹¤. ì˜ì–´ì— ìµìˆ™í•´ì§€ë©´ small talk ì—°ìŠµìœ¼ë¡œ ì¢‹ì€ê²ƒ ê°™ë‹¤. ë‘ë²ˆì§¸ëŠ” í…Œì´ë¸” í˜¸ìŠ¤íŠ¸ê°€ íŠ¹ì • í† í”½ì„ ê°€ì ¸ì˜¤ê³  ì‚¬ëŒë“¤ì´ ì°¸ì—¬í•˜ì—¬ í„´ì œ ë°©ì‹ìœ¼ë¡œ ëŒì•„ê°€ë©° ì§ˆë¬¸í•˜ê±°ë‚˜ ê°„ë‹¨í•œ ë‚´ìš©ì„ ì½ê³  ëŒ€ë‹µí•˜ê¸°ë‹¤.\në‚˜ëŠ” ë‘ë²ˆì§¸ ë°©ë²•ì´ ë§ëŠ”ê²ƒ ê°™ì•„ í•´ë‹¹ í…Œì´ë¸”ë“¤ì— ì°¸ì—¬í•´ì„œ ì–˜ê¸°í•˜ëŠ”ë° ë„ˆë¬´ ì¬ë°Œë‹¤ ã…‹ã…‹ã…‹ ì´ê²Œ ì „í˜€ ê³µë¶€ê°™ì§€ ì•Šê³  ê²Œì„í•˜ëŠ” ëŠë‚Œì´ë‹¤. ê±°ê¸°ë‹¤ ëª¨ë¥´ëŠ” ë‹¨ì–´ ë‚˜ì˜¤ë©´ ë¬¼ì–´ë³´ê³  í˜¸ìŠ¤íŠ¸ê°€ ëŒ€ë‹µí•´ì£¼ëŠ”ë° ì˜ì–´ë¡œ ì†Œí†µí•˜ë‹ˆ ë‹¨ì–´ì¥ë§Œ ë³´ë©° ì™¸ìš°ëŠ”ê²ƒë³´ë‹¤ íš¨ìœ¨ì´ ë„ˆë¬´ ì¢‹ë‹¤. ê·¸ëƒ¥ ë°”ë¡œ ì•”ê¸°ëœë‹¤.\nì˜¤ëŠ˜ì€ í˜¸ìŠ¤íŠ¸ê°€ Stephen Hawking ì „ê¸°ì— ëŒ€í•´ ì§§ì€ ì˜ˆë¬¸ì„ ê°€ì ¸ì™”ë‹¤. ê·¸ë˜ì„œ í•œ í˜ì´ì§€ë³„ë¡œ 3ëª…ì´ ëŒì•„ê°€ë©° ì½ê³  ëª¨ë¥´ëŠ” ë‹¨ì–´ì— ëŒ€í•´ ëœ»ê³¼ ë°œìŒì„ í”¼ë“œë°±í•´ì£¼ì—ˆë‹¤. ë¬¸ì œë„ ë‚´ê³  ë‹µì„ ì•„ëŠ” ì‚¬ëŒì´ ëŒ€ë‹µì„ í•˜ê³  ë‹¤ìŒ ì˜ˆë¬¸ìœ¼ë¡œ ë„˜ì–´ê°”ë‹¤. ë•ë¶„ì— paralyze, vigorousë€ ë‹¨ì–´ë¥¼ ì•Œê²Œë˜ì—ˆë‹¤.\në˜í•œ ì•±ì„ ì‚¬ìš©í•˜ë©° ì•Œê²Œëœ ë‚˜ìœ ë²„ë¦‡ì€ ë‚˜ëŠ” ë¬´ì¡°ê±´ ë¹ ë¥´ê²Œ ì–˜ê¸°í•˜ë ¤ê³  í•œë‹¤ëŠ” ê²ƒì´ë‹¤. ë§ì„ ë¹ ë¥´ê²Œ í•˜ë ¤ë‹ˆ ë¬¸ì¥ êµ¬ì„±ì´ ë¶€ì‹¤í•´ì§€ê³  ìš”ì ë„ ì•ˆë“œë¡œë©”ë‹¤ë¡œ ë‚ ì•„ê°„ë‹¤. ê·¸ë˜ì„œ ì²œì²œíˆ ë§í•˜ë©° ìš”ì ì„ ê°„ë‹¨í•˜ê²Œ ì„¤ëª…í•˜ê¸° ìœ„í•´ ì˜ì‹ì ìœ¼ë¡œ ë…¸ë ¥ì¤‘ì´ë‹¤.\nê³µê²©ì ìœ¼ë¡œ ì°¸ì—¬í•˜ê³  ì§ˆë¬¸í•˜ê³  ì–˜ê¸°í•˜ë‹ˆ ìì‹ ê°ì´ ì ì  ìƒê²¨ê°€ê³  ì˜ì–´ë¡œ ë§í•˜ëŠ”ê²ƒì— ìµìˆ™í•´ì§€ëŠ” ê²ƒ ê°™ë‹¤. ì´ ì•±ìœ¼ë¡œ íš¨ìœ¨ì ì´ê²Œ ê³µë¶€í•˜ë ¤ë©´ í‹€ë¦¬ê¸°ë¥¼ ë‘ë ¤ì›Œë§ê³  ë¬´ì¡°ê±´ ê³µê²©ì ìœ¼ë¡œ ë§í•˜ê³  ì¦ê¸°ë©° ë†€ì´ì²˜ëŸ¼ í•´ì•¼í•œë‹¤!\n(ì•± ê´‘ê³ ë¹„ ë°›ì§€ ì•Šì•˜ë‹¤. ê·¸ëƒ¥ ì¨ë³´ë‹ˆ ì¬ë°Œë”ë¼)\n","link":"https://www.ooseel.net/me/2022/03/training-english-speaking-at-home/","section":"posts","tags":null,"title":"ì§‘ì—ì„œ English Speaking ì—°ìŠµí•˜ê¸°"},{"body":"","link":"https://www.ooseel.net/me/tags/monthly-insight/","section":"tags","tags":null,"title":"monthly-insight"},{"body":"General  ì‚¶ì— ëŒ€í•œ ì§ˆë¬¸? ê·¸ ë‹µì„ ì°¾ë‹¤: ê´‘ê³ ê¸°íšì ë°•ì›…í˜„  Youtubeì— ì˜¬ë¼ì˜¨ EBS ì˜ìƒ í´ë¦½ì´ê³  ì´ #1, #2ë¡œ êµ¬ì„±ë˜ì–´ ìˆë‹¤. ì²­ì¤‘ë“¤ë¡œë¶€í„° ì—¬ëŸ¬ê°€ì§€ ì§ˆë¬¸ì„ ë°›ì•„ QNA í•˜ëŠ” í˜•ì‹ìœ¼ë¡œ ë˜ì–´ ìˆëŠ”ë° ê¹Šì€ ìƒê°ì„ í•˜ê²Œë” ë§Œë“œëŠ” ë‹µë³€ì„ ë§ì´ ì£¼ì‹ ë‹¤. ë‚´ê°€ ì¡´ê²½í•˜ëŠ” ë¶„ì´ë©° ì‚¶ì— ëŒ€í•´ ìì‹ 'ë§Œ'ì˜ ë‹µì„ ì°¾ê¸¸ ì›í•˜ì‹ ë‹¤ë©´ ì¶”ì²œí•œë‹¤.    ","link":"https://www.ooseel.net/me/2021/07/hashtag-monthly-insight-2021-07/","section":"posts","tags":["monthly-insight"],"title":"ì›”ê°„ ì¸ì‚¬ì´íŠ¸ - 2021ë…„ 7ì›”í˜¸"},{"body":"ì˜ëª»ëœ ì •ë³´ëŠ” https://github.com/memnoth/me/issues/1ì— ë‚¨ê²¨ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.\nList  Startupì—ì„œ D-cache=off ì„ì—ë„ ë¶ˆêµ¬í•˜ê³  cache line invalidation í•˜ëŠ” ëª©ì ì´ ë­”ê°€ìš”?  QnA Q. ì•„ë˜ ì½”ë“œì—ì„œ D-cache = off ì„ì—ë„ ë¶ˆêµ¬í•˜ê³  cache line invalidation í•˜ëŠ” ëª©ì ì´ ë­”ê°€ìš”? 1// \u0026#39;head.S\u0026#39; of linux kernel 5.10 2/* 3* Kernel startup entry point. 4* --------------------------- 5* 6* The requirements are: 7* MMU = off, D-cache = off, I-cache = on or off, 8* x0 = physical address to the FDT blob. 9* 10* ê¸°íƒ€ ë‚´ìš©ë“¤... 11*/ 12 13.... 14 15// In \u0026#39;preserve_boot_args\u0026#39; label, try invalidating cache lines 16// addressed to \u0026#39;boot_args\u0026#39; space. 17mov x1, #0x20 // 4 x 8 bytes 18b __inval_dcache_area // tail call A. 'D-cache = on' ì´í›„ data corruptionì„ ë°©ì§€í•˜ê¸° ìœ„í•¨ì…ë‹ˆë‹¤. ì»¤ë„ì´ ì´ˆê¸°í™” ì‘ì—…ì„ ì§„í–‰í•˜ê¸° ì´ì „ì—ëŠ” ì¼ë°˜ì ìœ¼ë¡œ bootloaderê°€ ì»¤ë„ì´ ë¶€íŒ…í•˜ëŠ”ë° í•„ìš”í•œ ìµœì†Œí•œì˜ ì¥ì¹˜ë“¤ì„ ì´ˆê¸°í™”í•©ë‹ˆë‹¤. ì—¬ê¸°ì—ëŠ” ë©”ëª¨ë¦¬ì™€ ê´€ë ¨ëœ ì‘ì—…ë“¤ë„ ë‹¹ì—°íˆ í¬í•¨ë˜ê³ ìš”. ì»¤ë„ì˜ startup pointì—ì„œëŠ” ì´ì „ì— ë¶€íŠ¸ë¡œë”ê°€ ì–´ë–¤ ì‘ì—…ì„ í–ˆëŠ”ì§€ ëª¨ë¦…ë‹ˆë‹¤ë§Œ ìœ„ requirementsì™€ ìµœì†Œí•œì˜ ì¥ì¹˜ë§Œ ì´ˆê¸°í™”ë˜ë©´ ë©ë‹ˆë‹¤. ì´ë•Œ cacheì—ëŠ” ì–´ë–¤ ì •ë³´ë“¤ì´ ë“¤ì–´ ìˆëŠ”ì§€ ëª¨ë¥´ëŠ” ìƒíƒœì´ê³ ìš”. ë”°ë¼ì„œ dirty dataê°€ ìºì‹±ë˜ì–´ ìˆì„ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.\nbootloaderê°€ ì‚¬ìš©í•œ ë˜ëŠ” ì»¤ë„ì´ ì•ìœ¼ë¡œ ì‚¬ìš©í•  ì£¼ì†Œì— ëŒ€í•´ cache line invalidation ì—†ì´ D-cache=on ì‹œì ì—ì„œ load/store ëª…ë ¹ì–´ë¥¼ ìˆ˜í–‰í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ ì‹œë‚˜ë¦¬ì˜¤ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Startup pointì—ì„œ D-cache=off ì¸ ì´ìœ ëŠ” ì´ê²ƒê³¼ ê´€ë ¨ì„±ì´ ì ì§€ë§Œ onì¼ ë•Œë¥¼ ìƒê°í•´ë³´ë©´ invalidationì€ ì¶©ë¶„í•œ ì´ìœ ì…ë‹ˆë‹¤.\n Load insts\nLoadì˜ src ì£¼ì†Œê°€ cache lineì— ì¡´ì¬í•œë‹¤ë©´ hit ë˜ì–´ dirty dataê°€ fetchë  ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤. Store insts\nStoreì˜ dest ì£¼ì†Œê°€ cache lineì— ì¡´ì¬í•œë‹¤ë©´ hit ë˜ì–´ í•´ë‹¹ ë¼ì¸ì˜ ë°ì´í„°ê°€ ê³„ì†ì ìœ¼ë¡œ ë³€ê²½ë©ë‹ˆë‹¤. ì´ë•Œ ë°ì´í„°ëŠ” ì‹¤ì œ ì˜ˆì¸¡í•œ ë°ì´í„°ê°€ ì•„ë‹ˆê² ì£ . dc cleanì„ ìˆ˜í–‰í•˜ê±°ë‚˜ lineì´ eviction ë˜ëŠ” ì‹œì ì—ì„œ ë©”ì¸ ë©”ëª¨ë¦¬ì˜ ë°ì´í„°ëŠ” out-of-date ì´ë¯€ë¡œ lineì— ìˆëŠ” dirty dataë¡œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.  ë”°ë¼ì„œ ë‹¤ìŒê³¼ ê°™ì€ ê²°ë¡ ì— ë„ë‹¬í•˜ê²Œ ë©ë‹ˆë‹¤. Chip booting í›„ ë˜ëŠ” bootloaderê°€ ì‚¬ìš©í•˜ê³  ë‚œ í›„ cache lineì— ë‚¨ì•„ ìˆëŠ” dirty dataë¥¼ ì •ë¦¬í•˜ê³  D-cache=on ì‹œì ì—ì„œ new dataë¥¼ ë©”ì¸ ë©”ëª¨ë¦¬ë¡œë¶€í„° ì°¸ì¡°í•˜ê¸° ìœ„í•¨ì…ë‹ˆë‹¤.\nReferences  https://stackoverflow.com/a/67347295 Enabling and disabling the DCache  ","link":"https://www.ooseel.net/me/2021/07/hashtag-cache-memory-qna/","section":"posts","tags":["linux","kernel","arm64"],"title":"Cache Memory QnA"},{"body":"Q. ì•„ë˜ì™€ ê°™ì´ startup pointì—ì„œ MMU ì™€ D-Cacheì˜ ìƒíƒœê°€ off ì—¬ì•¼ í•˜ëŠ”ë° ì´ìœ ê°€ ë­”ê°€ìš”? 1 // \u0026#39;head.S\u0026#39; of linux kernel 5.10 2 /* 3* Kernel startup entry point. 4* --------------------------- 5* 6* The requirements are: 7* MMU = off, D-cache = off, I-cache = on or off, 8* x0 = physical address to the FDT blob. 9* 10* This code is mostly position independent so you call this at 11* __pa(PAGE_OFFSET). 12* 13* Note that the callee-saved registers are used for storing variables 14* that are useful before the MMU is enabled. The allocations are described 15* in the entry routines. 16*/ A-1. MMU MMUëŠ” CPUê°€ ëª…ë ¹ì–´ë¥¼ ìˆ˜í–‰í•  ë•Œ ë©”ëª¨ë¦¬ì— ì ‘ê·¼í•  vaddr(Virtual Address)ë¥¼ paddr(Physical Address)ë¡œ ë³€í™˜í•˜ëŠ” ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ì´ë•Œ ì‚¬ìš©ë˜ëŠ” ìë£Œêµ¬ì¡°ê°€ ì£¼ì†Œ ë§¤í•‘ í…Œì´ë¸”ì¸ë° ì´ëŠ” ì»¤ë„ì´ ìƒì„±í•©ë‹ˆë‹¤. Startup ì½”ë“œê°€ ìˆ˜í–‰ë˜ëŠ” ì‹œì ì—ì„œëŠ” ë§¤í•‘ í…Œì´ë¸”ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë° MMUê°€ on ë˜ì–´ ìˆë‹¤ë©´ ë©”ëª¨ë¦¬ ì£¼ì†Œê°€ vaddrë¡œ í•´ì„ë©ë‹ˆë‹¤. ê²°êµ­ MMUê°€ ìˆ˜í–‰ë˜ê³  ì´ëŠ” paddrë¡œ ë³€í™˜ë˜ì–´ ì˜ë„ì¹˜ ì•Šì€ ë™ì‘ì´ ìˆ˜í–‰ë©ë‹ˆë‹¤. ì´ì™€ ê°™ì€ ì´ìœ ë¡œ ë§¤í•‘ í…Œì´ë¸”ì´ ìƒì„±ë˜ê¸° ì´ì „ì—ëŠ” MMUë¥¼ off í•´ì•¼í•©ë‹ˆë‹¤.\nA-2. D-Cache D-CacheëŠ” CPUì™€ ë©”ì¸ ë©”ëª¨ë¦¬ ì‚¬ì´ì—ì„œ ë°ì´í„°ë¥¼ ë¹ ë¥´ê²Œ ì ‘ê·¼í•˜ê¸° ìœ„í•œ ì €ì¥ì†Œ ì—­í• ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. ëŒ€ë¶€ë¶„ì˜ ì‹œìŠ¤í…œ í”„ë¡œê·¸ë˜ë¨¸ë“¤ì€ ì•Œë‹¤ì‹œí”¼ ì¢…ì¢… ìºì‹œì™€ ë©”ëª¨ë¦¬ê°„ ë°ì´í„° ì‹±í¬(Sync) ë¬¸ì œë“¤ì„ ë§ˆì£¼í•˜ê²Œ ë˜ëŠ”ë° startup ì‹œì ì—ì„œëŠ” paddrì—ì„œ ë°ì´í„°ë¥¼ ì§ì ‘ ì½ê±°ë‚˜ ì¨ì•¼ í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ D-Cacheê°€ on ë˜ì–´ ìˆë‹¤ë©´ paddrì—ì„œ ë°ì´í„°ë¥¼ ì½ëŠ” ëŒ€ì‹  ìºì‹œ ë©”ëª¨ë¦¬ì—ì„œ ì½ìœ¼ë¯€ë¡œ ì˜ë„ì¹˜ ì•Šì€ ë™ì‘ì„ ìˆ˜í–‰í•˜ê²Œ ë©ë‹ˆë‹¤. ì´ì™€ ê°™ì€ ì´ìœ ë¡œ D-Cacheë„ off í•´ì•¼í•©ë‹ˆë‹¤.\n","link":"https://www.ooseel.net/me/2021/07/why-mmu-and-d-cache-must-be-off-at-startup-point-in-arm64/","section":"posts","tags":["linux","kernel","arm64"],"title":"Why MMU and D-Cache must be off at Startup point"},{"body":"General  'ì›”ê°„ ì¸ì‚¬ì´íŠ¸' ì‹œì‘  ì•ˆë„í˜•ë‹˜ì´ ì‘ì„±í•˜ì‹  This month I Learndì„ ë³´ê³  ì‹œì‘í–ˆë‹¤. í¬ìŠ¤íŠ¸í•˜ëŠ”ê±´ ê·€ì°®ì§€ë§Œ ì¸ì‚¬ì´íŠ¸ë¥¼ ì–»ì€ ê¸€ì— ëŒ€í•´ ì›” ë‹¨ìœ„ë¡œ ì •ë¦¬í•˜ì—¬ ê³µìœ í•˜ê¸°ì— ì¢‹ì€ ë°©ë²•ì´ë¼ ìƒê°í•œë‹¤. ê¸°ì–µì†ì— ê³ ì´ ì ë“  ì¸ì‚¬ì´íŠ¸ ë„˜ì¹˜ëŠ” ê¸€ë“¤ì´ ë„ˆë¬´ë‚˜ ë§ë‹¤!   í‰ë²”í•œ ì¼ìƒì´ ì†Œì¤‘í•œ ì´ìœ   í‡´ê·¼ í›„ ë§¥ì£¼ í•œ ì”, ì €ë… ë…¸ì„ì„ ë³´ë©° ë›¸ ìˆ˜ ìˆëŠ” ì—¬ìœ . 30ëŒ€ì— ë“¤ì–´ì„œë©° 20ëŒ€ì— ê°€ì¡Œë˜ ìƒê°ì´ ë§ì´ ë°”ë€Œì—ˆë‹¤. 20ëŒ€ì—ëŠ” ì§€ê¸ˆì˜ ë‚˜ëŠ” ë‚´ ì¸ìƒì—ì„œ ë‘ë²ˆ ë‹¤ì‹œ ì˜¤ì§€ ì•Šì•„!ë¼ë©° ì•…ì°©ê°™ì´ ì—´ì‹¬íˆ ê²½í—˜ìŒ“ìœ¼ë©° ì‚´ì•˜ë‹¤. 30ëŒ€ê°€ ë˜ê³  ë‚˜ì„œëŠ” ì¸ìƒì˜ í° ì´ë²¤íŠ¸ë³´ë‹¤ ì¼ìƒì˜ ì†Œì†Œí•œ í–‰ë³µì„ ë” ì›í•œë‹¤. ì„±ê³µë³´ë‹¤ ì†Œì¤‘í•œ ì‚¬ëŒë“¤ê³¼ì˜ ì¶”ì–µì´ ë” ì¤‘ìš”í•´ì§€ëŠ” ì‹œê¸°ì¼ê¹Œ? ë³€í•˜ì§€ ì•Šì„ ê²ƒ ê°™ì•˜ë˜ ë‚´ê°€ ì„œì„œíˆ ë³€í•´ê°€ëŠ”ê°€ë³´ë‹¤.   ì‚¬ìˆ˜ì—†ì´ ì¼í•˜ë©° ì„±ì¥í•˜ëŠ” ë²•  ê°œë°œ 2ë…„ì°¨, ë‚´ê² ì‚¬ìˆ˜ê°€ ìˆì—ˆì„ê¹Œ? ì‚¬ìˆ˜ë€ ì–´ë–¤ ì¡´ì¬ì¼ê¹Œ? ì‚¬ìˆ˜ê°€ ìˆìœ¼ë©´ ì¢‹ì§€ë§Œ, ìš°ë¦¬ëŠ” í•˜ë£¨ ë¹¨ë¦¬ ì‚¬ìˆ˜ë¡œë¶€í„° ë…ë¦½í•˜ì—¬ ìŠ¤ìŠ¤ë¡œ ë‚˜ì•„ê°€ì•¼ í•œë‹¤. ì´ ê¸€ì€ ê·¸ë ‡ê²Œ ì„±ì¥í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ íŒíŠ¸ë¥¼ ì¤€ë‹¤.    Books  ì†Œí”„íŠ¸ì›¨ì–´ ì¥ì¸ - ì½ëŠ” ì¤‘  ì˜¬í•´ ìƒë°˜ê¸° ìµœê³ ì˜ ì±…ì„ ê¼½ìœ¼ë¼ë©´ ë‹¹ì—° ì´ ì±…ì´ë¼ ë§í•  ìˆ˜ ìˆë‹¤. ì²« ì…ì‚¬ ì´í›„ ì´ê±´ ì•„ë‹Œë°..., ì´ ì—…ë¬´ í”„ë¡œì„¸ìŠ¤ê°€ ì˜¬ë°”ë¥¸ ê²ƒì¼ê¹Œ..ë¼ë©° ìˆ˜ ì—†ì´ ìƒê°í•˜ê³  ìŠ¤ìŠ¤ë¡œì—ê²Œ ì§ˆë¬¸í•´ì™”ë˜ ë‚ ë“¤ ê·¸ëŸ¬ë‚˜ ì†Œë¦¬ì—†ëŠ” ì•„ìš°ì„±. ê·¸ ëª¨ë“  ì§ˆë¬¸ì— ëŒ€í•œ ëª…ì¾Œí•œ ë‹µ(?)ì´ ì´ ì±… í•˜ë‚˜ì— ëŒ€ë¶€ë¶„ ë“¤ì–´ìˆë‹¤. ê°œë°œìë¡œì„œ ì²« ì—…ë¬´ë¥¼ ì‹œì‘í•˜ëŠ”, ê·¸ëŸ¬ë‚˜ ë©€ê³  ë¨¼ í—˜ë‚œí•œ ê¸¸ì„ ê±¸ìœ¼ë ¤ëŠ” ì‚¬ëŒë“¤ì—ê²Œ ì´ ì±…ì€ ì˜¬ë°”ë¥¸ ê¸¸ë¡œ ì¸ë„í•˜ëŠ” ë‚˜ì¹¨ë°˜ê³¼ ê°™ì€ ì¡´ì¬ì´ë‹¤.    ","link":"https://www.ooseel.net/me/2021/06/hashtag-montly-insight-2021-06/","section":"posts","tags":["monthly-insight"],"title":"ì›”ê°„ ì¸ì‚¬ì´íŠ¸ - 2021ë…„ 6ì›”í˜¸"},{"body":"As some of you already know SIOCGIFADDR isn't supported on IPv6 socket although SIOCSIFADDR is. For sure there is a reason linux kernel doesn't do so but it's worth to build up by our hands, then we get to know much more in detail. This is good for us as a studying purpose rather than use in product.\nWe define simple ideas with some requirements, then look at kernel patch and a demo.\nIdeas A significant one is that an interface could have multiple IPv6 addresses, so our prototype would be the following result in user program perspective ...\n Take an IPv6 address and an interface name via args to set Get and print an IPv6 address mapped to an index of the required interface via its args. Assume the index would be 0 if the args isn't passed.  Assigning an address isn't a big deal but trying to get one is a bit complicated. Because we have to pass an index to kernel. For the requirement, use a member, struct in6_addr of struct in6_ifreq which the size of memory is 128 bits. Split the space into two parts and put the index value into the second space. We could even split it into 4 spaces of 32 bits based though, make it simple.\n1.-------------------------------------------. 2| 128 bits | \u0026lt;-- struct in6_addr 3\u0026#39;-------------------------------------------\u0026#39; 4 5^--------------------^ ^--------------------^ 6 64 bits 64 bits We use the following struct on both kernel and user program to serialize between them. It's originally from kernel, but manually port to the user program. Remember ifr6_addr is very important.\n1struct in6_ifreq { 2 struct in6_addr ifr6_addr; 3 u_int32_t ifr6_prefixlen; 4 unsigned int ifr6_ifindex; 5}; Here is a part of our test code, cmd_get function is the main routine implemented with SIOCGIFADDR but you could see the full code here.\n1static int cmd_get(int fd, int argc, char *argv[]) 2{ 3 char buf[256] = { 0, }; 4 struct in6_ifreq req; 5 struct ifreq ifr; 6 uint64_t *index = \u0026amp;((uint64_t*)\u0026amp;req.ifr6_addr)[1]; 7 8 init_ifindex(ifr); 9 10 memset(\u0026amp;req, 0, sizeof(struct in6_ifreq)); 11 /* Set index of nth address on the interface */ 12 *index = (argc == 1) ? 0 : atoi(argv[1]); 13 req.ifr6_prefixlen = 64; 14 req.ifr6_ifindex = ifr.ifr_ifindex; 15 retval_if( ioctl(fd, SIOCGIFADDR, \u0026amp;req), -5 /* 251 */, NULL ); 16 17 inet_ntop(AF_INET6, \u0026amp;req.ifr6_addr, buf, sizeof(buf)); 18 printf(\u0026#34;interface (%s) addr (%s)\\n\u0026#34;, argv[0], buf); 19 20 return 0; 21} 22 23int main(int argc, char *argv[]) 24{ 25 /* Skip useless code */ 26 retval_if( ((fd = socket(AF_INET6, SOCK_DGRAM, IPPROTO_UDP)), fd \u0026lt; 0), 27 -2 /* 254 */, NULL ); 28 /* Skip useless code */ 29 ret = cmd_get(fd, argc-2, argv+2); 30} As our ideas, a pointer named index points to the second space of struct in6_addr which sets on demand and assume our requirement is always with 64 bits prefix length.\nKernel patch Code is a bit simple. Look up and compare the index on the specified interface. See the line 44, kernel knows what number of addresses a user asks by parsing the index from user buffer and compare on 48 line. If the number is existed, copy the address to the same buffer and return back on the line, 84.\n1diff --git a/include/net/addrconf.h b/include/net/addrconf.h 2index ab8b3eb53d..97f8de4c09 100644 3--- a/include/net/addrconf.h 4+++ b/include/net/addrconf.h 5@@ -77,6 +77,7 @@ int addrconf_init(void); 6 void addrconf_cleanup(void); 7 8 int addrconf_add_ifaddr(struct net *net, void __user *arg); 9+int addrconf_get_ifaddr(struct net *net, void __user *arg); 10 int addrconf_del_ifaddr(struct net *net, void __user *arg); 11 int addrconf_set_dstaddr(struct net *net, void __user *arg); 12 13diff --git a/net/ipv6/addrconf.c b/net/ipv6/addrconf.c 14index 635b2482fa..46e9a80e7a 100644 15--- a/net/ipv6/addrconf.c 16+++ b/net/ipv6/addrconf.c 17@@ -2985,6 +2985,46 @@ static int inet6_addr_add(struct net *net, int ifindex, 18 return PTR_ERR(ifp); 19 } 20 21+static int inet6_addr_get(struct net *net, 22+ int ifindex, 23+ u32 ifa_flags, 24+ const struct in6_addr *pfx, 25+ unsigned int plen) 26+{ 27+\tstruct inet6_ifaddr *ifp; 28+\tstruct inet6_dev *idev; 29+\tstruct net_device *dev; 30+\tu64 upper, lower, i = 0; 31+ 32+\tif (plen \u0026gt; 128) 33+\treturn -EINVAL; 34+ 35+\tdev = __dev_get_by_index(net, ifindex); 36+\tif (!dev) 37+\treturn -ENODEV; 38+ 39+\tidev = __in6_dev_get(dev); 40+\tif (!idev) 41+\treturn -ENXIO; 42+ 43+\tupper = ((u64*)pfx)[0]; 44+\tlower = ((u64*)pfx)[1]; 45+ 46+\tread_lock_bh(\u0026amp;idev-\u0026gt;lock); 47+\tlist_for_each_entry(ifp, \u0026amp;idev-\u0026gt;addr_list, if_list) { 48+\tif (ifp-\u0026gt;prefix_len == plen \u0026amp;\u0026amp; lower == i++) { 49+\tread_unlock_bh(\u0026amp;idev-\u0026gt;lock); 50+ 51+\tmemcpy(pfx, \u0026amp;(ifp-\u0026gt;addr), sizeof(struct in6_addr)); 52+\treturn 0; 53+\t} 54+\tif (i \u0026gt; lower) 55+\tbreak; 56+\t} 57+\tread_unlock_bh(\u0026amp;idev-\u0026gt;lock); 58+\treturn -EINVAL; 59+} 60+ 61 static int inet6_addr_del(struct net *net, int ifindex, u32 ifa_flags, 62 const struct in6_addr *pfx, unsigned int plen) 63 { 64@@ -3053,6 +3093,28 @@ int addrconf_add_ifaddr(struct net *net, void __user *arg) 65 return err; 66 } 67 68+int addrconf_get_ifaddr(struct net *net, void __user *arg) 69+{ 70+\tstruct in6_ifreq ireq; 71+\tint err; 72+ 73+\tif (!ns_capable(net-\u0026gt;user_ns, CAP_NET_ADMIN)) 74+\treturn -EPERM; 75+ 76+\tif (copy_from_user(\u0026amp;ireq, arg, sizeof(struct in6_ifreq))) 77+\treturn -EFAULT; 78+ 79+\trtnl_lock(); 80+\terr = inet6_addr_get(net, ireq.ifr6_ifindex, 0, \u0026amp;ireq.ifr6_addr, 81+\tireq.ifr6_prefixlen); 82+\trtnl_unlock(); 83+ 84+\tif (!err \u0026amp;\u0026amp; copy_to_user(arg, \u0026amp;ireq, sizeof(struct in6_ifreq))) 85+\terr = -EFAULT; 86+ 87+\treturn err; 88+} 89+ 90 int addrconf_del_ifaddr(struct net *net, void __user *arg) 91 { 92 struct in6_ifreq ireq; 93diff --git a/net/ipv6/af_inet6.c b/net/ipv6/af_inet6.c 94index 14ac1d9112..6bb0da9fd5 100644 95--- a/net/ipv6/af_inet6.c 96+++ b/net/ipv6/af_inet6.c 97@@ -550,6 +550,8 @@ int inet6_ioctl(struct socket *sock, unsigned int cmd, unsigned long arg) 98 99 case SIOCSIFADDR: 100 return addrconf_add_ifaddr(net, (void __user *) arg); 101+\tcase SIOCGIFADDR: 102+\treturn addrconf_get_ifaddr(net, (void __user *) arg); 103 case SIOCDIFADDR: 104 return addrconf_del_ifaddr(net, (void __user *) arg); 105 case SIOCSIFDSTADDR: Demo time! Now make a test interface named br-demo on bridge layer, then assign an IPv6 address to it. Of course, try to get each addresses assigned to the interface.\n1root@OpenWrt:/# brctl addbr br-demo \u0026amp;\u0026amp; ifconfig br-demo up 2root@OpenWrt:/# ifconfig 3br-demo Link encap:Ethernet HWaddr 06:FA:DC:0E:5F:84 4 inet6 addr: fe80::4fa:dcff:fe0e:5f84/64 Scope:Link 5 UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 6 RX packets:0 errors:0 dropped:0 overruns:0 frame:0 7 TX packets:5 errors:0 dropped:0 overruns:0 carrier:0 8 collisions:0 txqueuelen:1000 9 RX bytes:0 (0.0 B) TX bytes:454 (454.0 B) 10 11root@OpenWrt:/# demo_ipv6 12usage: demo_ipv6 \u0026lt;command\u0026gt; 13 14- command 15 add : \u0026lt;ifname\u0026gt; \u0026lt;ipv6 address\u0026gt; 16 get : \u0026lt;ifname\u0026gt; [index] 17 18root@OpenWrt:/# demo_ipv6 add br-demo 2001:0db8:85a3::8a82 19root@OpenWrt:/# ifconfig br-demo 20br-demo Link encap:Ethernet HWaddr 06:FA:DC:0E:5F:84 21 inet6 addr: fe80::6ce4:38ff:fe99:74d2/64 Scope:Link 22 inet6 addr: 2001:db8:85a3::8a82/64 Scope:Global 23 UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 24 RX packets:0 errors:0 dropped:0 overruns:0 frame:0 25 TX packets:12 errors:0 dropped:0 overruns:0 carrier:0 26 collisions:0 txqueuelen:1000 27 RX bytes:0 (0.0 B) TX bytes:1360 (1.3 KiB) 28 29root@OpenWrt:/# demo_ipv6 get br-demo 30interface (br-demo) addr (2001:db8:85a3::8a82) 31root@OpenWrt:/# demo_ipv6 get br-demo 1 32interface (br-demo) addr (fe80::6ce4:38ff:fe99:74d2) 33root@OpenWrt:/# demo_ipv6 get br-demo 2 34root@OpenWrt:/# echo $? 35251 36root@OpenWrt:/# demo_ipv6 get br-demo 0 37interface (br-demo) addr (2001:db8:85a3::8a82) Conclusion This were a simple tutorial though, we could see that IOCTL programming is a way to communicate between kernel and user programs and give lots of opportunities for hacking the kernel.\nStay Safe!\n","link":"https://www.ooseel.net/me/2021/02/design-siocgifaddr-on-ipv6-socket/","section":"posts","tags":null,"title":"Design SIOCGIFADDR on IPv6 socket"},{"body":"1ë…„ì„ ë˜ëŒì•„ ë³´ëŠ” í–‰ë™ì€ ì–¸ì œë‚˜ ë‚¯ì„¤ê³  ê¸´ì¥ëœë‹¤. ìê¸° ë°˜ì„±ì„ ìœ„í•´ ì§€ë‚œ 1ë…„ê°„ì˜ í™œë™ì„ ê°ê´€ì ìœ¼ë¡œ ë°”ë¼ë´ì•¼ í•˜ëŠ”ë° ì´ ê³³ì— ë§ì€ ëª»í•´ë„ ê°€ìŠ´ ì“°ë¦° ê¸°ì–µë“¤ì„ ë„ì§‘ì–´ ë‚´ì•¼í•˜ë‹ˆ ë§ì´ë‹¤. ì´ ê¸€ì€ **ë‚˜**ë¥¼ ë˜ëŒì•„ ë³´ëŠ” ê¸€ì´ë‹¤.\n9ì›”ë¶€í„° ì‹¤ë‚´ì•”ë²½ ë“±ë°˜ì„ ë‹¤ì‹œ ì‹œì‘í–ˆë‹¤. ì§€ê¸ˆì€ 2.5ë‹¨ê³„ë¡œ ì¸í•´ ì‰¬ê³  ìˆì§€ë§Œ 1ì›”ì— ê·¸ë§Œë‘” ë’¤ë¡œ 8ê°œì›”ë§Œì´ì—ˆë‹¤. íšŒì‚¬-ì§‘-ê³µë¶€ íŒ¨í„´ìœ¼ë¡œ ëª‡ ë‹¬ì„ ì§€ë‚´ë‹ˆ ìŠ¤íŠ¸ë ˆìŠ¤ê°€ í’€ë¦¬ì§€ ì•Šì•„ ë¶ˆë©´ì¦ì— ìŠ¬ëŸ¼í”„ê¹Œì§€ ê²¹ì³¤ëŠ”ë° ìì¡´ê° ì¸¡ë©´ì—ì„œ í™•ì‹¤íˆ ìš´ë™í•˜ê³  ì•ˆ í•˜ê³ ì˜ ì°¨ì´ê°€ ì¡´ì¬í•œë‹¤. ë•€ì„ í™• ë¹¼ê³  ì§‘ì— ê°ˆ ë•Œ ëŠë¼ëŠ” ë°¤ ê³µê¸°ì˜ ìƒì¾Œí•¨, ì´ ëŠë‚Œì€ ì—¬ì „íˆ ë‚´ê°€ ì‚´ì•„ ì¡´ì¬í•˜ëŠ” ëŠë‚Œì„ ì¤€ë‹¤. ë˜í•œ ì‚¬ì†Œí•œ ë¬¸ì œë¼ë„ ëª‡ ê°œ í’€ì—ˆë‹¤ëŠ” ì‚¬ì‹¤ê³¼ ì•”ì¥ íšŒì›ë“¤ê³¼ì˜ ìœ ëŒ€ê´€ê³„ê°€ íšŒì‚¬ ì—…ë¬´ë¡œ ì¸í•´ ê°•ì§ëœ ë§ˆìŒì„ ë…¹ì—¬ì¤€ë‹¤. ëª¨ë“  ì¸ì—°ì—ì„œ ë°°ìš¸ ì ì´ ìˆìŒì„ ìš”ì¦˜ë“¤ì–´ ë§ì´ ëŠë¼ëŠ”ë° ë‹¤ë“¤ ì°©í•˜ê³  ììœ ë¡­ê³  ìœ ì—°í•œ ì‚¬ê³ ë¥¼ ê°€ì§€ê³  ìˆë‹¤. ê·¸ë ‡ê¸°ì— ê·¸ë“¤ê³¼ í•¨ê»˜í•˜ëŠ” ê²ƒì´ ì¦ê±°ìš´ì§€ë„ ëª¨ë¥´ê² ë‹¤.\ní•˜ë°˜ê¸°ì—ëŠ” ìê¸°ê°ê´€í™”ë¥¼ ìœ„í•´ ë…¸ë ¥ì„ ë§ì´ í–ˆìœ¼ë‚˜ ì—¬ì „íˆ í˜¼ë€ìŠ¤ëŸ½ë‹¤. ë‚˜ì— ëŒ€í•´ ëª‡ê°€ì§€ ì•Œê²Œëœ ì‚¬ì‹¤ì€ ê¼°ëŒ€í™”ê°€ ì§„í–‰ë˜ê³  ìˆë‹¤ëŠ” ê²ƒê³¼ ì‹œê°„ë‚­ë¹„ê°€ ë§ë‹¤ëŠ” ê²ƒì´ë‹¤. ë‚˜ì™€ ë‹¤ë¦„ì„ ì¸ì •í•˜ì§€ ëª»í•  ë•Œê°€ ì¢…ì¢… ìˆê³  ìœ„ë¡œë¼ëŠ” ëª…ëª©í•˜ì— ì£¼ëŠ” ê°•ì œ ì¡°ì–¸, í–‰ë™ì€ ì–´ë¥¸ìŠ¤ëŸ½ì§€ ëª»í–ˆê³  ë‚¨íƒ“í•  ë•Œë„ ìˆì—ˆë‹¤. ì´ëŸ¬ë‹¤ ë³´ë‹ˆ ì •ì‘ ì¤‘ìš”í•œ ê²ƒì— ì§‘ì¤‘í•˜ì§€ ëª»í•¨ì€ ë¬¼ë¡  ë‚˜ì˜ í–‰ë™ì´ ìƒëŒ€ë°©ì—ê²Œ ìƒì²˜ê°€ ë˜ì—ˆê³  ì†Œëª¨ë˜ëŠ” ì—ë„ˆì§€ë„ ë§ì•˜ë‹¤. ë‚´ë…„ì€ ë¶€ë”” ëœ ê¼°ëŒ€ìŠ¤ëŸ¬ì› ìœ¼ë©´ í•˜ëŠ” ë°”ë¨ì´ë‹¤.\nê°œë°œìë¡œì„œ ë„ì „ê³¼ ê¹¨ë‹¬ìŒ ìš´ì´ ì¢‹ì•˜ë‹¤. ì˜¬í•´ëŠ” ì»¨íŠ¸ë¦¬ë·°í†¤ì„ í†µí•´ í•œ ë‹¬ê°„ ìƒˆë¡œìš´ê±¸ ê²½í—˜í•  ìˆ˜ ìˆëŠ” ì¢‹ì€ ê¸°íšŒê°€ ìˆì—ˆìœ¼ë‹ˆ ë§ì´ë‹¤. ì¸ë©”ëª¨ë¦¬ ìºì‹œ ì„œë²„ ì†”ë£¨ì…˜(ARCUS)íŒ€ì— ì°¸ì—¬í•˜ì˜€ëŠ”ë° í‰ì†Œì—ë„ ì´ëŸ° ì¢…ë¥˜ì˜ ì†”ë£¨ì…˜ë“¤ì´ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ê¶ê¸ˆí•˜ê¸°ë„ í–ˆë‹¤. í•´ì‹œë§µì´ë‚˜ ì„ í˜• ë¦¬ìŠ¤íŠ¸ì— ëŒ€í•œ ì•Œê³ ë¦¬ì¦˜ë“¤ ë§ì´ë‹¤. ìºì‹± ì†”ë£¨ì…˜ë“¤ì€ í¼í¬ë¨¼ìŠ¤ê°€ ì¢‹ì•„ì•¼í•˜ë‹ˆ íš¨ìœ¨ì ì¸ ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•˜ê³  ìˆì–´ í•™ë¶€ì—ì„œ ì–•ê²Œ ë°°ìš´ ë‚´ìš©ë“¤ì´ í˜„ì¥ì—ì„œ ì‚¬ìš©ë˜ëŠ” ë°©ì‹ì„ ìŠµë“í•˜ê¸°ì— ê°€ì¥ ì¢‹ì€ í™˜ê²½ì´ë‹¤.\nì´ë²ˆì—” ì°¸ì—¬í•˜ëŠ” ë°©ì‹ì„ ì¡°ê¸ˆ ë‹¬ë¦¬ í•´ë´¤ëŠ”ë° ë©˜í† ë‹˜ë“¤ì´ ì£¼ì‹œëŠ” ê³¼ì œì— ëŒ€í•´ ìˆ˜ë™ì ìœ¼ë¡œ í–‰ë™í•˜ê¸° ë³´ë‹¤ í† ì´ í”„ë¡œì íŠ¸ë¥¼ ì£¼ë„í–ˆë‹¤. FUSE í”„ë ˆì„ì›Œí¬ì™€ ARCUS ì†”ë£¨ì…˜ì„ ì¡°í•©í•˜ì—¬ ìºì‹œ ì„œë²„ ë©”ëª¨ë¦¬ì— ì €ì¥ëœ Key-Value ë°ì´í„°ë“¤ì„ VFS(ê°€ìƒ íŒŒì¼ ì‹œìŠ¤í…œ)ìœ¼ë¡œë„ ì œê³µí•˜ëŠ” í”„ë¡œì íŠ¸ì˜€ë‹¤. ì´ì— ëŒ€í•´ ê°„ëµíˆ ì„¤ëª…í•˜ìë©´ ì—”ì§„ì— í‚¤ê°€ ì €ì¥ë  ë•Œ VFSì˜ ìºì‹œ ë¦¬ìŠ¤íŠ¸ì—ë„ ë™ì¼í•œ í‚¤ë¥¼ ì €ì¥í•œë‹¤. ì´ ì‘ì—…ì€ ì—”ì§„ê³¼ VFSì˜ Key ë¦¬ìŠ¤íŠ¸ ë™ê¸°í™”ê°€ ì¤‘ìš”í•˜ë‹¤. ì´í›„ì— ì‚¬ìš©ìê°€ VFSì´ ì œê³µí•˜ëŠ” íŒŒì¼(ì´ë¦„ì´ Keyì™€ ë™ì¼)ì— ëŒ€í•´ cat, tree ëª…ë ¹ì–´ë¥¼ ìˆ˜í–‰í•˜ë©´ ì—”ì§„ì„ í†µí•´ Value ê°’ì„ ê°€ì ¸ì™€ ì‚¬ìš©ìì—ê²Œ ì œê³µí•œë‹¤. ìì„¸í•œ ë‚´ìš©ì€ í”„ë¡œì íŠ¸ ë§í¬ ì°¸ê³ .\níšŒì‚¬ì—ì„œ ìƒˆ í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ë˜ ì‹œê¸°ì™€ ì»¨íŠ¸ë¦¬ë·°í†¤ì´ ê²¹ì³¤ëŠ”ë° í”„ë¡œì íŠ¸ë„ ê¸°ê°„ì´ ì§§ì•˜ê³  ì»¨íŠ¸ë¦¬ë·°í†¤ì€ í•œ ë‹¬ ë‚¨ì§“ì´ì—ˆë‹¤. ë‘˜ë‹¤ ì¼ì •ì´ íƒ€ì´íŠ¸í•´ì„œ ì—…ë¬´ ì™¸ ë‚¨ëŠ” ì‹œê°„ì—ëŠ” í‰ì¼/ì£¼ë§ ìƒê´€ì—†ì´ ë°¤ ëŠ¦ê²Œê¹Œì§€ ì—”ì§„ì„ ë¶„ì„í•˜ê³  VFS ë ˆì´ì–´ë¥¼ êµ¬í˜„í–ˆë‹¤. ì´ë•Œ ë„ˆë¬´ í˜ë“¤ì—ˆê³  ìŠ¤íŠ¸ë ˆìŠ¤ë„ ë§ì´ ë°›ì•˜ì§€ë§Œ ì„ê³„ì ì„ í•œë²ˆ ë„˜ê¸°ë‹ˆ ì´í›„ë¡œ ì¤‘ê·œëª¨ í”„ë¡œì íŠ¸ë¥¼ ë¶„ì„í•˜ëŠ”ë° ìì‹ ê°ì´ ìƒê¸°ê¸° ì‹œì‘í–ˆë‹¤.\nì»¨íŠ¸ë¦¬ë·°í†¤ ì´í›„ë¡œ JavaScript ì—”ì§„ì¸ JerryScript ìŠ¤í„°ë””ë¥¼ ì‹œì‘í–ˆëŠ”ë° ì§„í–‰ ê²½í—˜ì´ ê±°ì˜ ì—†ì—ˆê³  ì˜ˆì „ì—ë„ í•œë²ˆ ì‹œë„í–ˆë‹¤ê°€ ì‹¤íŒ¨í•œ ì ì´ ìˆì—ˆë‹¤. ìš°ì—°ì°®ê²Œ ë°±ê¸°ì„ ë‹˜ì´ ì˜¬ë¦¬ì‹  ìŠ¤í„°ë”” ëª¨ì§‘ì— ëŒ€í•œ ì˜ìƒì„ ë³´ê²Œ ë˜ì—ˆëŠ”ë° \u0026quot;ì²˜ìŒì—ëŠ” ëˆ„êµ¬ë‚˜ ì„œíˆ´ë‹¤. ê·¸ëŸ¬ë‚˜ ì‹œë„í•˜ë©´ì„œ í”¼ë“œë°±ì„ ë°›ê³  ë³´ì™„í•´ ê°€ëŠ” ê²ƒì´ë‹¤\u0026quot;ë¼ê³  ë§ì”€í•˜ì‹  ê²ƒì— ìš©ê¸°ë¥¼ ì–»ì–´ ì‹œì‘í–ˆë‹¤. ì¤‘ê°„ì— ê·¸ë§Œë‘ë”ë¼ë„ ì‹œë„ í•œ ê²ƒì´ í•˜ì§€ ì•Šì€ ê²ƒë³´ë‹¤ ë‚«ì§€ ì•Šê² ëŠ”ê°€. ìŠ¤í„°ë””ì— ì°¸ì—¬í•˜ì‹  ë¶„ì˜ ì‹¤ë ¥ì´ ì¢‹ìœ¼ì…”ì„œ ì§„ë„ê°€ ì •ë§ ë¹¨ë¦¬ ë‚˜ê°”ëŠ”ë°, ì´ 8ì£¼ë¥¼ ê³„íší–ˆìœ¼ë‚˜ ì²« ì£¼ì— ì´ë¯¸ Lexer íŒŒíŠ¸ì— ëŒ€í•´ í° ê·¸ë¦¼ì„ ê·¸ë ¸ê³  ë§ˆì§€ë§‰ ì£¼ì—ëŠ” íŒ¨ì¹˜ë¥¼ ë°˜ì˜ì‹œì¼°ë‹¤. 2ê¸°ë¥¼ ì§„í–‰í•˜ë ¤ë‹¤ê°€ ì»¤ë„ê³¼ ê´€ë ¨ëœ ë¶€ë¶„ì„ ê³µë¶€í•˜ëŠ”ê²Œ ì¢‹ì„ ê²ƒ ê°™ì•„ì„œ ê·¸ë§Œë‘ì—ˆì§€ë§Œ ê·¸ë™ì•ˆì˜ ìŠ¤í„°ë””ê°€ ì‹œê°„ë‚­ë¹„ë¼ëŠ” ìƒê°ì€ ë“¤ì§€ ì•ŠëŠ”ë‹¤.\në°ì´í„°ë² ì´ìŠ¤ ì—”ì§„, ì»´íŒŒì¼ëŸ¬ ëª¨ë‘ ë‚´ê°€ ê´€ì‹¬ìˆë˜ ë¶„ì•¼ì˜€ì§€ë§Œ ì´ ê¸€ì„ ì“°ëŠ” ì‹œì ì— ê¹¨ë‹¬ì€ ê²ƒì€ ë‘ ë¶„ì•¼ì— ëŒ€í•´ ì•„ì§ì€ ê·¸ëƒ¥ í¥ë¯¸ë§Œ ìˆë‹¤ëŠ” ê²ƒì´ë‹¤. ì–´ì©Œë©´ ë„ˆë¬´ ì´ë¥¸ íŒë‹¨ì¼ì§€ë„ ëª¨ë¥´ê² ë‹¤. í•˜ì§€ë§Œ í•œ ê°€ì§€ ì‚¬ì‹¤ì€ ì§€ê¸ˆì€ ë¦¬ëˆ…ìŠ¤ ì»¤ë„ì´ ë” ì¬ë°Œê³  ì´ê²ƒì— ì—´ì •ì„ ìŸê³  ì‹¶ë‹¤. JerryScriptëŠ” ë‹¹ë¶„ê°„ ë‚´ í¥ë¯¸ì˜ í•œ ê³µê°„ì— ê³ ì´ ëª¨ì…”ë‘ê³  ì¬ë¯¸ë¡œ ë¶„ì„í•˜ë ¤ê³  í•œë‹¤.\níšŒì‚¬ì—ì„œëŠ” ì´ê²ƒì €ê²ƒ ë‹¤ì–‘í•˜ê²Œ ê²½í—˜í–ˆë‹¤. í¥ë¯¸ë¡œìš´ ì´ìŠˆë“¤ì„ ë§ì´ ì£¼ì…¨ê³  ë©”ì¸ ì—…ë¬´ì´ê¸°ë„ í–ˆëŠ”ë° ì»¤ë„ ê´€ë ¨ëœê²Œ ëª‡ ê°€ì§€ ìˆì—ˆë‹¤. 1ë…„ì°¨ ê°œë°œìê°€ ë¬´ì—‡ì„ ì•Œê² ëŠ”ê°€, ì»¤ë„ ë²„ê·¸ ëŒ€ë¶€ë¶„ì´ ë””ë²„ê¹…í•˜ê¸° ë¬´ì²™ ì–´ë ¤ì› ëŠ”ë° ì‹œê°„ì€ ê³„ì† íë¥´ê³  ì¼ì •ì€ ë‹¤ê°€ì˜¤ëŠ”ë° ì§„í–‰ì´ ì•ˆë˜ë‹ˆ ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ë§ì´ ë°›ì•˜ë‹¤. ì´ë•Œ ìì¡´ê°ì´ ì™„ì „ ë°”ë‹¥ì„ ì³¤ê³  \u0026quot;ì´ ê¸¸ì´ ë‚´ ê¸¸ì´ ì•„ë‹Œê°€\u0026quot; ë¼ëŠ” ìƒê°ì´ ë“¤ë©° êµ‰ì¥íˆ ì‹¬ë€í–ˆë‹¤. ë¶ˆí‰í•´ë´¤ì ìƒí™©ì€ ë‚˜ì•„ì§€ì§€ ì•Šìœ¼ë‹ˆ ì–´ë–»ê²Œë“  í•´ê²°í•˜ë ¤ê³  ë°¤ìƒˆ ê³µë¶€í•˜ë©° ë°œë²„ë‘¥ì³¤ê³  ë‹¤í–‰íˆë„ ì¼ì •ë‚´ì— í•´ê²°í–ˆë‹¤.\nìŠ¤íŠ¸ë ˆìŠ¤ ë°›ë˜ ë‹¹ì‹œì—ëŠ” ëª°ëì§€ë§Œ ëŒì•„ë³´ë‹ˆ ì € ê²½í—˜ì´ ì„±ì¥ì˜ ê¸°í­ì œë¡œ ì‘ìš©í•œ ê²ƒ ê°™ë‹¤. ì´í›„ë¡œ ë¦¬ëˆ…ìŠ¤ ì»¤ë„ì„ ë°”ë¼ë³´ëŠ” ì‹œê°ê³¼ ì—…ë¬´ì— ëŒ€í•œ íƒœë„ê°€ ë‹¬ë¼ì¡Œìœ¼ë©° ë²„ê·¸ì— ëŒ€í•œ ë‘ë ¤ì›€ì€ ì—¬ì „íˆ ì¡´ì¬í•˜ì§€ë§Œ ë§ˆìŒì€ í•œì¸µ ë” ë‹¨ë‹¨í•´ì¡Œë‹¤.\në§ˆì¹˜ë©°.. ì˜¬í•´ëŠ” ë°”ì˜ê²Œ ì§€ëƒˆìŒì—ë„ ë¶ˆêµ¬í•˜ê³  ì•„ì‰¬ì›€ì´ ë§ì´ ë‚¨ëŠ”ë‹¤. ê·¸ ì•„ì‰¬ì›€ì€ \u0026quot;ê·¸ë•Œ ì ê·¹ì ìœ¼ë¡œ í–‰ë™í–ˆë”ë¼ë©´..\u0026quot; í•˜ëŠ” ë§ˆìŒì´ë¦¬ë¼. ë‚´ë…„ì—ëŠ” ê¼­ \u0026quot;2021ë…„ì€ ëœ ê¼°ëŒ€ìŠ¤ëŸ¬ì› ë„¤ìš”. ë‹¤í–‰ì…ë‹ˆë‹¤!\u0026quot; ë¼ëŠ” ë§ì„ í•  ìˆ˜ ìˆê¸¸ ë°”ë¼ê³  ì´ ê¸€ì„ ì½ëŠ” ë¶„ë“¤ì—ê²ŒëŠ” ì¶•ë³µì´ ë”°ë¥´ê¸¸ ê¸°ì›í•œë‹¤.\n(ë°°ê³ í”„ë‹ˆ ì¹˜í‚¨ ğŸ— ì‹œì¼œì•¼ê² ë‹¤)\n","link":"https://www.ooseel.net/me/2020/12/look-back-to-2020/","section":"posts","tags":null,"title":"2020ë…„ì„ ë˜ëŒì•„ ë³´ëŠ” ê¸€"},{"body":"Have you ever experienced such horrible signals between core processes which might crash a whole system? I had done. Unknown signals are a kind of critical issue in product.\nSomeone says \u0026quot;Better safe than sorry\u0026quot;. I like that quote. Even though software world is totally chaotic on bugs, we should at least try some approaches being safe. Especially signals. They never log while on their way unless we trigger so that could quietly stab your back one day if you are off the guard.\nThis article is about an approach let you be safe from them.\nOur softwares are running on a software. we call it as Operating System. If we can read its code, modify as we want, why not put our idea into it? Say more straight, \u0026quot;hook the code where signals walk inside kernel\u0026quot;.\nPractice! time Let's specify some wishes for our goal. I'm going to make this more simple and they are only three which are signals' ...\n Sender's name/pid Signal's number Receiver's name/pid  Signal processing has three stages in simple saying.\n kill syscall or from kernel ready to signal wake up the target process  We're going to hook at the last of the second stage. Because most exceptions, for example dereferencing NULL pointers are already considered at the boundary between the second and third.\n1/* kernel/signal.c */ 2static int __send_signal(int sig, 3 struct kernel_siginfo *info, 4 struct task_struct *t, 5 enum pid_type type, 6 bool force) 7{ 8 struct sigpending *pending; 9 struct sigqueue *q; 10 int override_rlimit; 11 int ret = 0, result; 12 13 /* ... A LOT CODE HERE ... */ 14 15 complete_signal(sig, t, type); 16ret: 17 trace_signal_generate(sig, info, t, type != PIDTYPE_PID, result); 18 return ret; 19} Here's one of functions signals walk and as the callee's name, complete_signal gives a clue, hook points are its ahead/behind. I pick ahead.\nNow code a few lines.\n1/* kernel/signal.c */ 2static int __send_signal(int sig, 3 struct kernel_siginfo *info, 4 struct task_struct *t, 5 enum pid_type type, 6 bool force) 7{ 8 struct sigpending *pending; 9 struct sigqueue *q; 10 int override_rlimit; 11 int ret = 0, result; 12 13 /* ... A LOT CODE HERE ... */ 14 15 /* Our code! */ 16 if (sig != 17 /* SIGCHLD in Arm */ \u0026amp;\u0026amp; 17 sig != 14 /* SIGALRM in Arm */ \u0026amp;\u0026amp; 18 info \u0026amp;\u0026amp; t) 19 { 20 int srcpid, dstpid; 21 char src[TASK_COMM_LEN] = { 0, }; 22 char dst[TASK_COMM_LEN] = { 0, }; 23 struct task_struct * cur_task = NULL; 24 25 if (!force) { 26 srcpid = info-\u0026gt;si_pid; 27 cur_task = find_task_by_vpid(srcpid); 28 } else 29 srcpid = 0; /* just for kernel case */ 30 31 dstpid = t-\u0026gt;pid; 32 memcpy(src, cur_task ? cur_task-\u0026gt;comm : \u0026#34;kernel\u0026#34;, TASK_COMM_LEN-1); 33 memcpy(dst, t-\u0026gt;comm, TASK_COMM_LEN-1); 34 35 printk(KERN_INFO \u0026#34;Signal :: (%s %d) --[%d]--\u0026gt; (%s %d)\\n\u0026#34;, 36 src, srcpid, 37 sig, 38 dst, dstpid); 39 } 40 41 complete_signal(sig, t, type); 42ret: 43 trace_signal_generate(sig, info, t, type != PIDTYPE_PID, result); 44 return ret; 45} There are two type of sender, SI_USER and SI_KERNEL. force is set to false or true respectively. According to that, cur_task has sender's info or being NULL represents kernel so that we finally decide sender's name.\nWe do ignore SIGCHLD and SIGALRM used for a signal notification to its parent that itself exited and time interval like a timer by kernel respectively to prevent dmesg flooding.\ndmesg 1root@OpenWrt:/# reboot 2[ 56.365579] Signal :: (reboot 1286) --[15]--\u0026gt; (procd 1) 3[ 56.452796] Signal :: (procd 1) --[15]--\u0026gt; (hostapd 705) 4[ 56.460590] Signal :: (procd 1) --[15]--\u0026gt; (wpa_supplicant 706) 5[ 56.504500] Signal :: (killall 1350) --[15]--\u0026gt; (dropbear 597) 6[ 56.551519] Signal :: (procd 1) --[15]--\u0026gt; (odhcpd 822) 7[ 56.599167] Signal :: (procd 1) --[15]--\u0026gt; (logd 430) 8[ 56.701690] Signal :: (netifd 766) --[15]--\u0026gt; (udhcpc 1044) 9[ 56.728474] br-wan: port 1(eth0) entered disabled state 10[ 56.738012] device eth0 left promiscuous mode 11[ 56.743576] br-wan: port 1(eth0) entered disabled state 12[ 56.769219] smsc95xx 1-1.1:1.0 eth0: hardware isn\u0026#39;t capable of remote wakeup 13[ 57.730085] Signal :: (procd 1) --[15]--\u0026gt; (ubusd 141) 14[ 57.737611] Signal :: (procd 1) --[15]--\u0026gt; (askfirst 143) 15[ 57.745295] Signal :: (procd 1) --[15]--\u0026gt; (urngd 177) 16[ 57.752705] Signal :: (procd 1) --[15]--\u0026gt; (brcmf_wdog/mmc1 293) 17[ 57.760934] Signal :: (procd 1) --[15]--\u0026gt; (dnsmasq 534) 18[ 57.768427] Signal :: (procd 1) --[15]--\u0026gt; (netifd 766) 19[ 57.775770] Signal :: (procd 1) --[15]--\u0026gt; (ntpd 1070) 20[ 57.782966] Signal :: (procd 1) --[15]--\u0026gt; (sh 1476) 21[ 57.790105] Signal :: (ntpd 1070) --[15]--\u0026gt; (ntpd 1070) 22[ 57.790712] Signal :: (kernel 0) --[1]--\u0026gt; (askfirst 143) 23[ 58.791265] Signal :: (procd 1) --[9]--\u0026gt; (ash 142) 24[ 58.799449] Signal :: (kernel 0) --[1]--\u0026gt; (ash 142) ftrace and strace ftrace is really cool. I love and often use it. But it has a steep learning curve as much as its flexibility than most tracers. Not only that reason, but also roughly able to trace them at the early stage of boot or halt.\nstrace traces only one program at a time. That means you must execute it as many as you'd like to trace. NOT the whole system.\nThis strategy might be good for both linux distros we mainly use in laptops and embedded systems. But more comfy on the latter for a test. This is a rough idea rather than bad article like \u0026quot;this one is better than others\u0026quot;.\nI hope you get inspired a lot and would be happy to have emails if someone has good ideas more than mine :-)\nStay safe!\n","link":"https://www.ooseel.net/me/2020/12/tricky-signal-tracing-in-kernel/","section":"posts","tags":null,"title":"Tricky Signal Tracing in Kernel"},{"body":"I use my left pinky to jump back and forth in vim with cscope, ctags + vim comb a lot everyday. Especially ctrl + t, o, ] and so on. However, it has been hurt slightly. I thought that it might be by the use of the pinky a lot, so that looked for a solution in Google. Firstly, I could have modified my input method program a bit such that swap between Ctrl and Caps Lock, but felt frustrated all the steps code level to testing. At a random period of time looking for solutions, I just looked down, see my keyboard and found out there was a key saying \u0026quot;Switch layer\u0026quot;.\nI said \u0026quot;Yeh, that's it!\u0026quot;\nI am currently using Vortex Race 3 and it has it. It supports 4 switch layers and be able to customize user keymap in each one. So I swapped these two keys, Caps Lock and Ctrl. Yet I am still trying to get used to the new map, my pinky gets better. :-)\n    Let me say this, not all keyboards existed support this functionality. You should check it out first.\n","link":"https://www.ooseel.net/me/2020/08/vim-pinky-and-programmable-keyboard/","section":"posts","tags":null,"title":"Vim Pinky and Programmable Keyboard"},{"body":"","link":"https://www.ooseel.net/me/tags/gnome/","section":"tags","tags":null,"title":"Gnome"},{"body":"","link":"https://www.ooseel.net/me/tags/gtk+/","section":"tags","tags":null,"title":"GTK+"},{"body":"Hello, everyone!\nThere is a meetup named Cron-a-thon held by Ubuntu-KR Daejeon team every 2 weeks. However, I put the workshop on the table at the meetup 3 months ago. The administrators and I talked about the organization of an event for the beginners who were into how to build a GTK+ application in Python. That was the beginning of the workshop.\nBefore we talk about the workshop, let's look at goods a bit.\n    They are so cool, aren't they?! I had stickers from our community, 30 sheets of stickers that ordered and brochures. The workshop wasn't just only for talking about GTK+, but also I wanted audiences to get to know about our community, GNOME. What we do and who we are looking for. The brochure was for that. Stickers? Well...\nRoses are red Violets are blue Developers like stickers. - Unknown  The Workshop was about how to build a GTK+ application for the beginners as I said above. So it consisted of several sections.\n What and why GTK+ Basic principles Basic widgets (practice) Build a small project  The first and second sections talked about the foundation of GUI programming such as things behind GTK+ application, and rough ideas of Event-Driven Programming.\nIn my opinion, things behind GTK+ and how applications work are more significant than others. Once we have known what there are and how they work, we can clarify where we should examine for issues. For this reason, I wished they make sure of the foundation.\nD-Day (Jan, 13th) It was the day of the event, GTK+ workshop in Daejeon. I was really excited to see audiences. But on the other hand, I was nervous a bit!\nThe first and second sections talked about the foundation of GUI programming such as things behind GTK+ application, and rough ideas of Event-Driven Programming.\nIn my opinion, things behind GTK+ and how applications work are more significant than others. Once we have known what there are and how they work, we can clarify where we should examine for issues. For this reason, I wished they make sure of the foundation. Jan, 13th day\nIt was the day of the event, GTK+ workshop in Daejeon. I was really excited to see audiences. But on the other hand, I was nervous a bit!\nThey were really keeping an eye on the workshop and one more that, they found an issue in source code and fixed it themselves!\nAnyway, the workshop took about 4 hours. There was a critical issue I did not expect, but I think we were successfully finished!\nAbout Flatpak To me, this workshop was a kind of trial to use Flatpak as a development environment. You might know that preparing the environment for audiences is absolutely painful. We have to think out of everything like ... they could have all different versions even in the same linux distro, or library dependencies! I really didn't want them to feel such a pain while setting up.\n Using Virtual Machines like VirtualBox, VMware could be the one of the solutions, but GUI programs on that machines response slow. Also in the meantime, while I was preparing, I thought of Flatpak as another option. It was really cool. I did not need to take care of the dependencies at all. With pre-installed GNOME SDK and GNOME Builder, just done.\nProblems are always unpredictable - Me  One of them brought Ubuntu 16.04. He was done with SDK and Builder installation. But when he tried to run an application for the practice session, he got errors that could not run. For the workaround, he run them on his host machine instead of Flatpak.\nYet we should use Virtual Machines for providing the same environment. But I am sure that Flatpak will be there in the future.\nThanks to First, I would like to give BIG THANKS to Ubuntu-KR Daejeon team and GNOME community staffs. I couldn't have done this workshop without their helps. Also, ê°•ì²œì„± who is a student of CNU, he helped with printing out the brochures.\nThis organization was my first time. I was not enough, but I have learnt how I should be ready to give a speech. See you guys next time, Bye! :-)\n    ","link":"https://www.ooseel.net/me/2019/01/gtk-workshop-in-daejeon/","section":"posts","tags":["Linux","GTK+","Gnome"],"title":"GTK+ Workshop in Daejeon"},{"body":"","link":"https://www.ooseel.net/me/about/","section":"","tags":null,"title":""},{"body":"","link":"https://www.ooseel.net/me/categories/","section":"categories","tags":null,"title":"Categories"},{"body":"","link":"https://www.ooseel.net/me/series/","section":"series","tags":null,"title":"Series"}]